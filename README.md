# gazette-api

Calling The [Gazette](https://www.thegazette.co.uk/data) API

The API docs can be found on Github, [TheGazette/DevDocs](https://github.com/TheGazette/DevDocs)

I have so far [registered](https://github.com/TheGazette/DevDocs/blob/master/authentication/registration.md) on The Gazette website, but can't seem to be able to [sign in](https://github.com/TheGazette/DevDocs/blob/master/authentication/sign-in.md) despite following the instructions from the docs as closely as possible

I have tried signing in using both the `requests` and `oauthlib` libraries but both without success. The different errors encountered with each methods are documented below

=================================================

## CODE

#### USING REQUESTS

**Source:** `call-api-with-requests.py`

Using the requests library returns a 403 error with the following response

```
'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">\n<HTML><HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">\n<TITLE>ERROR: The request could not be satisfied</TITLE>\n</HEAD><BODY>\n<H1>403 ERROR</H1>\n<H2>The request could not be satisfied.</H2>\n<HR noshade size="1px">\nRequest blocked.\nWe can\'t connect to the server for this app or website at this time. There might be too much traffic or a configuration error. Try again later, or contact the app or website owner.\n<BR clear="all">\nIf you provide content to customers through CloudFront, you can find steps to troubleshoot and help prevent this error by reviewing the CloudFront documentation.\n<BR clear="all">\n<HR noshade size="1px">\n<PRE>\nGenerated by cloudfront (CloudFront)\nRequest ID: 43EaXsvQTdbIecIla7hDOj204r8xbTf4vO5aZaqClRIBh-rlTV6KZw==\n</PRE>\n<ADDRESS>\n</ADDRESS>\n</BODY></HTML>'
```

The main point of confusion for me is around whether a Basic authentication token is needed or not, and if needed what the value should be

The Docs from the Gazette clearly state as a prerequisites that "to access the Gazette OAuth token endpoint, your API client must use an appropriate Basic authentication token. Please contact TSO customer service to get the Basic authentication token for accessing the token endpoint"

However when I contacted the customer service of both TSO and The Gazette I was assured - on more than one occasion - that "The Gazette is an open API meaning you are able to access it without any token"

But if I try sending in without adding an authentication token within the request `headers` I get the same 403 error and response as detailed above. It might be worth quickly noting here that sending a `GET` requests to `insolvency/notice/data.json` without signing in, using the code below, also returns the same error and response

```
url = "https://www.thegazette.co.uk/insolvency/notice/data.json"
r = requests.get(url)
```

I have tried sending my requests to different urls to see if the response changes and I reiceive the same 403 error and response for whichever Gazette url I send my request to. Or at least this was true for the following urls...

```
https://www.thegazette.co.uk/oauth/token
https://www.thegazette.co.uk/
https://www.thegazette.co.uk/lol
https://www.thegazette.co.uk/wlaisbvnibfds
```

If I send the same request to `www.google.com` or `www.github.com` I do get different responses however.

I have tried various modification on the code currently commited in this repo.
For instance, I have tried adding either `application/json` or `application/x-www-form-urlencoded` as the `Content-type` value in the `headers`. I have also tried adding changing the token value in the `headers` to `Basic tttttttttttttttttttt` or `Basic xxxxxx`, but all of these attemps still returned the same 403 error and response.

---

#### USING OAUTHLIB

**Source:** `call-api-with-oauthlib.py`

The code here is based on the example for the `Resource Owner Password Credentials Grant` - as mentioned in The Gazette API documentation - from the [oauthlib docs](https://requests-oauthlib.readthedocs.io/en/latest/oauth2_workflow.html#legacy-application-flow). See `Legacy Application Flow` in the oauthlib docs.

In this case I get the following error...

```
oauthlib.oauth2.rfc6749.errors.MissingTokenError: (missing_token) Missing access token parameter.
```

I have again tried various modification on the code currently commited in this repo.
For instance, I have tried passing the `username` as the value for the `client_id` in `LegacyApplicationClient()` rather than the `basic_token`. I have tried adding the `scope` as a parameter of either `OAuth2Session()` or `fetch_token()` rather than `LegacyApplicationClient()`. I have also tried removing `include_client_id=True` from `fetch_token()` but all of these attemps still returned the same error.

=================================================

## USEFUL LINKS
[The Gazette website](https://www.thegazette.co.uk/data)

[The Gazette API Docs on GitHub](https://github.com/TheGazette/DevDocs)

[The requests docs](https://2.python-requests.org/en/master/user/quickstart/#errors-and-exceptions)

[The oauthlib docs](https://requests-oauthlib.readthedocs.io/en/latest/oauth2_workflow.html)
